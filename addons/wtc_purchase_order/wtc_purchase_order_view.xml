<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
		
		<record model="ir.ui.view" id="wtc_branch_on_purchase_order_form_view">
		    <field name="name">wtc.branch.purchase.order.form</field>
		    <field name="model">purchase.order</field>
		    <field name="type">form</field>
		    <field name="inherit_id" ref="purchase.purchase_order_form"/>
		    <field name="arch" type="xml">
		    	
		    	<button name="purchase_confirm" position="attributes">
		    		<attribute name="invisible">1</attribute>
		    	</button>
		    	
		    	<xpath expr="/form/sheet/group" position="before">
		    		<group>
		    			<group>
			            	<field name="branch_id" options="{'no_open':True,'no_create':True}" attrs="{'readonly': ['|',('state','not in','draft'),('name','!=','/')]}" on_change="onchange_picking_type_id(branch_id,picking_type_id)"/>
			            </group>
			            <group>
							<field name="division" on_change="onchange_division(branch_id,division,partner_id)" attrs="{'readonly': ['|',('state','not in','draft'),('name','!=','/')]}"/>
						</group>
					</group>		            
		    	</xpath>
		    	 
		    	<xpath expr="//button[@name='action_cancel']" position="after">
		    		 <button name="%(report_purchase_order)d"  type="action" string="Print" class="oe_highlight"  icon="gtk-print" groups="wtc_purchase_order.group_purchase_order_cancel"/>
		    	</xpath>
		    	
		    	<xpath expr="//button[@name='action_cancel']" position="attributes">
		    		 <attribute name="groups">wtc_purchase_order.group_purchase_order_cancel</attribute>
		    	</xpath>
		    	
		    	<xpath expr="//button[@name='action_close']" position="attributes">
		    		 <attribute name="groups">wtc_purchase_order.group_purchase_order_close_order</attribute>
		    	</xpath>
		    	
		    	<xpath expr="//field[@name='pricelist_id']" position="replace">
		    		<field domain="[('type','=','purchase')]" name="pricelist_id" invisible="1" groups="product.group_purchase_pricelist" on_change="onchange_pricelist(pricelist_id, context)"/>
		    	</xpath>
		    	
		    	<field name="date_order" position="replace"/>
		    	<field name="payment_term_id" position="replace"/>
		    	<field name="picking_type_id" position="before">
		    		<field name="date_order" readonly="1"/>
		    	</field>
		        <field name="partner_id" position="attributes">
		        	<attribute name="context">{'division':division}</attribute>
		        	<attribute name="options">{'no_open':True,'no_create_edit':True}</attribute>
		        </field>		        
		        <field name="location_id" position="attributes">
		        	<attribute name="invisible">1</attribute>
		        </field>
		        <button name="action_cancel_draft" position="attributes">
		        	<attribute name="invisible">1</attribute>
		        </button>
		        
		        <field name="incoterm_id" position="attributes">
		        	<attribute name="invisible">1</attribute>
		        </field>
		        
		        <field name="validator" position="attributes">
		        	<attribute name="invisible">1</attribute>
		        </field>
		        
		        <field name="date_approve" position="attributes">
		        	<attribute name="invisible">1</attribute>
		        </field>
		        
		        <field name="fiscal_position" position="attributes">
		        	<attribute name="invisible">1</attribute>
		        </field>
		        
		        <field name="bid_validity" position="attributes">
		        	<attribute name="attrs">{'readonly': [('state','not in','draft')]}</attribute>
		        </field>
		        
		        <field name="minimum_planned_date" position="attributes">
		        	<attribute name="attrs">{'readonly': [('state','not in','draft')]}</attribute>
		        </field>
		        
		        <field name="requisition_id" position="attributes">
		        	<attribute name="attrs">{'readonly': [('state','not in','draft')]}</attribute>
		        </field>
		        
		        <!--field name="invoice_method" position="attributes">
		        	<attribute name="invisible">1</attribute>
		        </field-->
		        
				<xpath expr="//field[@name='product_id']" position="attributes">
                    <attribute name="options">{'no_open':True,'no_create_edit':True}</attribute>
                    <attribute name="domain">[('id','=',0)]</attribute>
				</xpath>
				
				<xpath expr="//field[@name='product_id']" position="before">
					<field name="categ_id" on_change="category_change(categ_id,parent.branch_id,parent.division,parent.pricelist_id)" domain="[('name','=',parent.division)]" options="{'no_open':True,'no_create':True}"/>
				</xpath>
		        
			    <xpath expr="//field[@name='date_planned']" position="replace">
			    	<field name="date_planned" invisible="1"/>
			    </xpath>
			    
			    <xpath expr="//field[@name='account_analytic_id']" position="replace">
                    <field name="account_analytic_id" groups="purchase.group_analytic_accounting" domain="[('type','not in',('view','template'))]" invisible="1"/>
			    </xpath>
			    
			    <field name="product_qty" position="after">
			    	<field name="qty_invoiced" readonly="1"/>
			    	<field name="received" readonly="1"/>
			    </field>
			    
			    <field name="price_unit" position="replace">
			    	<field name="price_unit" invisible='1' on_change="price_unit_change(price_unit)"/>
			    	<field name="price_unit_show" readonly='1'/>
                    <field name="taxes_id_show" readonly="1" widget="many2many_tags" domain="[('parent_id','=',False),('type_tax_use','!=','sale')]"/>
			    </field>
			    
			    <field name="taxes_id" position="replace">
			    	<field name="taxes_id" invisible='1' on_change="change_tax(taxes_id)" widget="many2many_tags" domain="[('parent_id','=',False),('type_tax_use','!=','sale')]"/>
			    </field>
			    
				<field name="partner_ref" position="after">
					<field name="payment_term_id" options="{'no_open': True, 'no_create': True}" required="1" attrs="{'readonly': [('state','not in','draft')]}"/>
					<field name="purchase_order_type_id" options="{'no_open':True,'no_create_edit':True}" domain="[('category','=',division)]" on_change="purchase_order_type_id_change(purchase_order_type_id)" attrs="{'readonly': [('state','not in','draft')]}"/>
					<label for="start_date" string="Effective Date"/>
					<div>
						<field name="start_date" class="oe_inline" on_change="effective_date_change(start_date,end_date)" attrs="{'readonly': [('state','not in','draft')]}"/> - <field name="end_date" class="oe_inline" on_change="effective_date_change(start_date,end_date)" attrs="{'readonly': [('state','not in','draft')]}"/>
					</div>
				</field>
				
				<field name="picking_type_id" position="attributes">
					<attribute name="on_change">onchange_picking_type_id(branch_id,picking_type_id)</attribute>
				</field>
				
			    <xpath expr="//page[@string='Deliveries &amp; Invoices']" position="after">
					<page string="Hotline" col="1" attrs="{'invisible': [('division','!=','Sparepart')]}">
						<group col="4">
							<field name="po_ref" attrs="{'readonly': [('state','not in','draft')]}"/>
							<field name="dealer_id" attrs="{'readonly': [('state','not in','draft')]}"/>
							<field name="back_order" attrs="{'readonly': [('state','not in','draft')]}"/>
							<field name="salesman_id" attrs="{'readonly': [('state','not in','draft')]}"/>
							<field name="no_claim" attrs="{'readonly': [('state','not in','draft')]}"/>
							<field name="ship_to" attrs="{'readonly': [('state','not in','draft')]}"/>
							<field name="delivery_date" attrs="{'readonly': [('state','not in','draft')]}"/>
							<field name="customer_id" attrs="{'readonly': [('state','not in','draft')]}"/>
							<field name="post_code" attrs="{'readonly': [('state','not in','draft')]}"/>
							<field name="type_motor_id" attrs="{'readonly': [('state','not in','draft')]}"/>
							<field name="assembling" attrs="{'readonly': [('state','not in','draft')]}"/>
							<field name="of_the_road" widget="radio" attrs="{'readonly': [('state','not in','draft')]}"/>
							<field name="return_service" widget="radio" attrs="{'readonly': [('state','not in','draft')]}"/>
						</group>
					</page>
				</xpath>
			</field>
		</record>
		
        <record id="purchase_form_action_showroom" model="ir.actions.act_window">
            <field name="name">Purchase Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">purchase.order</field>
            <field name="view_mode">tree,form,graph,calendar</field>
            <field name="context">{}</field>
            <field name="domain">[('division','in',('Unit','Umum'))]</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a quotation that will be converted into a purchase order. 
              </p><p>
                Use this menu to search within your purchase orders by
                references, supplier, products, etc. For each purchase order,
                you can track the related discussion with the supplier, control
                the products received and control the supplier invoices.
              </p>
            </field>
        </record>

        <record id="purchase_form_action_workshop" model="ir.actions.act_window">
            <field name="name">Purchase Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">purchase.order</field>
            <field name="view_mode">tree,form,graph,calendar</field>
            <field name="context">{}</field>
            <field name="domain">[('division','=','Sparepart')]</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a quotation that will be converted into a purchase order. 
              </p><p>
                Use this menu to search within your purchase orders by
                references, supplier, products, etc. For each purchase order,
                you can track the related discussion with the supplier, control
                the products received and control the supplier invoices.
              </p>
            </field>
        </record>
                		
		<menuitem action="purchase_form_action_showroom" id="menu_purchase_form_action_4" parent="wtc_dealer_menu.showroom_purchase_menu" sequence="2"/>
		<menuitem action="purchase_form_action_workshop" id="menu_purchase_form_action_5" parent="wtc_dealer_menu.workshop_purchase_menu" sequence="2"/>
		
        <record id="view_voucher_filter_vendor" model="ir.ui.view">
            <field name="name">account.voucher.purchase.select</field>
            <field name="model">account.voucher</field>
            <field name="arch" type="xml">
                <search string="Search Vouchers">
                    <field name="number" string="Voucher"/>
                    <field name="date"/>
                    <filter icon="terp-document-new" string="Draft" domain="[('state','=','draft')]" help="Draft Vouchers"/>
                    <filter icon="terp-camera_test" string="Posted" domain="[('state','=','posted')]" help="Posted Vouchers"/>
                    <field name="partner_id" string="Supplier" filter_domain="[('partner_id','child_of',self)]"/>
                    <field name="journal_id" widget="selection" context="{'journal_id': self, 'set_visible':False}" domain="[('type','in',('purchase','purchase_refund'))]"/> <!-- Keep widget=selection on this field to pass numeric `self` value, which is not the case for regular m2o widgets! -->
                    <field name="period_id"/>
                    <group expand="0" string="Group By">
                        <filter string="Supplier" icon="terp-personal" domain="[]" context="{'group_by':'partner_id'}"/>
                        <filter string="Journal" icon="terp-folder-orange" domain="[]" context="{'group_by':'journal_id'}"/>
                        <filter string="Period" icon="terp-go-month" domain="[]" context="{'group_by':'period_id','visible':True}"/>
                        <filter string="Status" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                    </group>
                </search>
            </field>
        </record>      
          
		<record id="view_wtc_purchase_order" model="ir.ui.view">
            <field name="name">wtc.purchase.order.search.view</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase.view_purchase_order_filter"/>
            <field name="arch" type="xml">
            	<field name="name" position='after'>
            		<field name='branch_id'/>
                    <field name="division"/> 
                    <group expand="0" string="Group By">
                        <filter string="Type" domain="[]" context="{'group_by':'purchase_order_type_id'}"/>
                    </group>                 	                    	
            	</field>
            </field>
        </record>  
                
        <record id="action_purchase_receipt" model="ir.actions.act_window">
            <field name="name">Payment Request Old</field>
            <field name="res_model">account.voucher</field>
            <field name="view_type">form</field>
            <field name="domain">[('journal_id.type','in',['purchase','purchase_refund']), ('type','=','purchase')]</field>
            <field name="context">{'default_type': 'purchase', 'type': 'purchase'}</field>
            <field name="view_id" eval="False"/>
            <field name="search_view_id" eval="view_voucher_filter_vendor"/>
            <field name="target">current</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to register a purchase receipt. 
              </p><p>
                When the purchase receipt is confirmed, you can record the
                supplier payment related to this purchase receipt.
              </p>
            </field>
        </record>
        
        <record model="ir.ui.view" id="wtc_purchase_order_line_tree">
            <field name="name">wtc.purchase.order.line.tree</field>
            <field name="model">purchase.order.line</field>
            <field name="inherit_id" ref="purchase.purchase_order_line_tree"/>
            <field name="arch" type="xml">
                <field name="product_qty" position="after">
                    <field name="qty_invoiced"/>
                </field>
            </field>
        </record>
		
        <menuitem action="account.action_invoice_tree2" id="menu_action_invoice_tree3" parent="wtc_dealer_menu.showroom_purchase_menu" sequence="4"/>
        <menuitem action="account.action_invoice_tree2" id="menu_action_invoice_tree4" parent="wtc_dealer_menu.workshop_purchase_menu" sequence="4"/>

        <menuitem action="account_voucher.action_vendor_payment" icon="STOCK_JUSTIFY_FILL" sequence="7"
           id="menu_action_vendor_payment2"  parent="wtc_dealer_menu.workshop_purchase_menu"/>
        <menuitem action="account_voucher.action_vendor_payment" icon="STOCK_JUSTIFY_FILL" sequence="7"
           id="menu_action_vendor_payment3"  parent="wtc_dealer_menu.showroom_purchase_menu"/>  
        <menuitem action="account_voucher.action_vendor_payment" icon="STOCK_JUSTIFY_FILL" sequence="7"
           id="menu_action_vendor_payment4" parent="wtc_dealer_menu.backoffice_bankandcash_menu"/> 
<!-- New -->

        <menuitem
            action="purchase.purchase_line_form_action2"
            id="menu_purchase_line_order_draft_showroom"
			parent="wtc_dealer_menu.showroom_purchase_menu" sequence="3"/>    
        <menuitem
            action="purchase.purchase_line_form_action2"
            id="menu_purchase_line_order_draft_workshop"
			parent="wtc_dealer_menu.workshop_purchase_menu" sequence="3"/> 				     	           	
     </data>
</openerp>