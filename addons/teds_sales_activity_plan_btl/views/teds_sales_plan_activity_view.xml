<?xml version="1.0"?>
<openerp>
	<data>
		<record id="view_teds_sales_plan_activity_tree" model="ir.ui.view">
			<field name="name">teds.sales.plan.activity.tree</field>
			<field name="model">teds.sales.plan.activity</field>
			<field name="priority">1</field>
			<field name="arch" type="xml">
				<tree>
					<field name="branch_id"/>
					<field name="name"/>
					<field name="bulan"/>
					<field name="tahun"/>
					<field name="state"/>
				</tree>
			</field>
		</record>
		
		<record id="view_teds_sales_plan_activity_form" model="ir.ui.view">
			<field name="name">teds.sales.plan.activity.form</field>
			<field name="model">teds.sales.plan.activity</field>
			<field name="priority">1</field>
			<field name="arch" type="xml">
				<form create="false" delete="false">
					<header>
						<button name="action_rfa" string="RFA" type="object" class="oe_highlight" states="draft" groups="teds_sales_activity_plan_btl.group_rfa_activity_btl_button"/>
						<button name="action_print_btl" string="Print BTL" type="object" attrs="{'invisible':[('state','not in',('approved','open'))]}"/>
						<button name="action_add_activity" string="Add Activity" type="object" class="oe_highlight" attrs="{'invisible':[('state','not in',('approved','open'))]}" groups="teds_sales_activity_plan_btl.group_add_activity_btl_button"/>
						<field name="state" widget="statusbar" statusbar_visible="draft,waiting_for_approval,approved"/>
					</header>
					<div class="oe_title">
						<h1>
							<field name="name" attrs="{'invisible':[('name','=',False)]}" readonly="1"/>	
						</h1>
					</div>
					<group>
						<field name="branch_id" options="{'no_open':True,'no_create':True}" required="1" attrs="{'readonly':[('name','!=',False)]}"/>
						<label for="bulan" string="Periode"/>
                        <div>
                            <field name="bulan" required="1" class="oe_inline" attrs="{'readonly':[('state','!=','draft')]}"/> 
                            <field name="tahun" required="1" class="oe_inline" attrs="{'readonly':[('state','!=','draft')]}"/>
                        </div>
                        <field name="total_biaya_btl"/>
					</group>
					<notebook>
						<page string="Detail">
							<field name="activity_line_ids" nolabel="1" attrs="{'readonly':[('state','!=','draft')]}">
								<tree colors="blue:state == 'draft';">
									<field name="jaringan_penjualan" color="red:status_am == 'reject'"/>
									<field name="name"/>
									<field name="act_type_id" options="{'no_open':True,'no_create':True}"/>
									<field name="titik_keramaian_id" options="{'no_open':True,'no_create':True}"/>
									<field name="ring_id" options="{'no_open':True,'no_create':True}"/>
									<field name="kecamatan_id" options="{'no_open':True,'no_create':True}"/>
									<field name="pic_id" options="{'no_open':True,'no_create':True}"/>
									<field name="is_location"/>
									<field name="start_date"/>
									<field name="end_date"/>
									<field name="total_biaya"/>
									<field name="target_unit"/>
									<field name="target_customer"/>
									<field name="state" string="Status"/>
								</tree>
								<form>
									<sheet>
				                        <group>
											<group>
												<field name="branch_id" invisible="1"/>
												<field name="state" invisible="1"/>
												<field name="jaringan_penjualan" required="1"/>
												<field name="act_type_id" options="{'no_open':True,'no_create':True}" required="1"/>
												<field name="act_type_code" invisible="1"/>
												<field name="titik_keramaian_id" options="{'no_open':True,'no_create':True}" required="1" domain="[('branch_id','=',branch_id)]"/>
												<field name="ring_id" options="{'no_open':True,'no_create':True}"/>
												<field name="is_location"/>
												<field name="source_pos_location_id" attrs="{'invisible':['|',('is_location','=',False),('jaringan_penjualan','!=','POS')],'required':[('is_location','!=',False),('jaringan_penjualan','=','POS')]}" options="{'no_open':True,'no_create':True}" domain="[
													('branch_id','=',branch_id),
													('jenis','=','pos'),
													('start_date','&lt;=',context_today().strftime('%Y-%m-%d')),
													('end_date','&gt;=',context_today().strftime('%Y-%m-%d'))
													]"/>
												<field name="jenis_pengajuan" attrs="{'invisible':[('is_location','=',False)],'required':[('is_location','!=',False)]}"/>
												<field name="location_id" options="{'no_open':True,'no_create':True}" domain="[('branch_id','=',branch_id),('usage','=','internal'),('jenis','in',('pameran','channel','canvasing'))]" attrs="{'invisible':['|',('jenis_pengajuan','!=','update'),('is_location','=',False)],'required':[('jenis_pengajuan','=','update')]}"/>
				                          		<field name="name" attrs="{'invisible':[('jenis_pengajuan','=','update')],'required':['|',('is_location','=',False),('jenis_pengajuan','=','new')]}"/>
				                          		<field name="display_unit" attrs="{'invisible':[('is_location','=',False)],'required':[('is_location','!=',False)]}"/>
												<field name="target_unit" required="1"/>
												<field name="target_customer" required="1"/>
				                          	</group>
				                          	<group>
												<label for="start_date" string="Periode"/>
						                        <div>
						                            <field name="start_date" required="1" placeholder="Start Date" class="oe_inline"/> - 
						                            <field name="end_date" required="1" placeholder="End Date" class="oe_inline"/>
						                        </div>
						                        <field name="pic_id" options="{'no_open':True,'no_create':True}" required="1"/>
												<field name="nik"/>
												<field name="job"/>
												<field name="no_telp" required="1"/>
												<field name="foto" attrs="{'invisible':[('is_location','=',False)],'required':[('act_type_code','in',('PM','CH','RS'))]}" widget="image" img_height="150" width="150" height="150" filename="filename_foto"/>
												<field name="filename_foto" invisible="1"/>
											</group>
										</group>
										<group string="Address">
											<group>
												<field name="street" attrs="{'required':[('is_location','!=',False)]}"/>
												<field name="rt" class="oe_inline"/>
												<field name="rw" class="oe_inline"/>
											</group>
											<group>
												<field name="state_id" options="{'no_open':True,'no_create':True}" readonly="1"/>
												<field name="city_id" options="{'no_open':True,'no_create':True}" readonly="1"/>
												<field name="kecamatan_id" options="{'no_open':True,'no_create':True}"/>
												<field name="kelurahan_id" options="{'no_open':True,'no_create':True}"/>
											</group>
										</group>
										<group attrs="{'invisible':[('state','=','draft')]}">
											<group string="Status AM">
												<field name="status_am" readonly="1" attrs="{'invisible':[('status_am','=',False)]}"/>
												<field name="reason_reject_am" readonly="1" attrs="{'invisible':[('status_am','!=','reject')]}"/>
											</group>
											<group string="Status Operational">
												<field name="state" string="Status Location" readonly="1"/>
												<field name="reason_reject_location" readonly="1" attrs="{'invisible':[('reason_reject_location','=',False)]}"/>
												<field name="status_operation" readonly="1" attrs="{'invisible':[('status_operation','=',False)]}" string="Status Operational"/>
												<field name="reason_reject_operation" readonly="1" attrs="{'invisible':[('status_operation','!=','reject')]}"/>

											</group>

										</group>
										<group string="Biaya">
											<field name="total_biaya" readonly="1"/>
											<field name="detail_biaya_ids" string="Detail Biaya">
												<tree editable="bottom">
													<field name="name" required="1"/>
													<field name="finco_id" attrs="{'readonly':[('name','!=','Leasing')],'required':[('name','=','Leasing')]}" options="{'no_open':True,'no_create':True}"/>
													<field name="tipe" required="1"/>
													<field name="amount" required="1" sum="Total"/>
													<field name="is_ppn" readonly="1"/>
													<field name="subtotal"/>
													<field name="state" invisible="1"/>
												</tree>
											</field>
										</group>
										<group string="History Activity">
											<field name="qty_customer_last" readonly="1"/>
											<field name="history_location_ids" string="Unit 3 Bulan Terakhir">
												<tree create='false' edit='false' delete='false'>
													<field name="name"/>
													<field name="qty" sum="Total"/>
												</tree>
												<form>
													<sheet>
														<group>
															<field name="name"/>
															<field name="qty"/>
														</group>
														<notebook>
															<page string="Detail Pencapaian">
																<field name="detail_ids" nolabel="1">
																	<tree>
																		<field name="product_id" options="{'no_open':True,'no_create':True}"/>
																		<field name="categ_id" options="{'no_open':True,'no_create':True}"/>
																	</tree>
																	<form>
																		<sheet>
																			<group>
																				<field name="product_id" options="{'no_open':True,'no_create':True}"/>
																				<field name="categ_id" options="{'no_open':True,'no_create':True}"/>
																			</group>
																		</sheet>
																	</form>
																</field>
															</page>
														</notebook>
													</sheet>
												</form>
											</field>
										</group>
										<group string="Actual Plan" attrs="{'invisible':[('state','!=','done')]}">
											<notebook>
												<page string="SPK">
													<field name="spk_ids" readonly="1">
														<tree editable="top">
															<field name="name" string="No SPK"/>
															<field name="date_order"/>
															<field name="partner_id"/>
														</tree>
													</field>
												</page>
												<page string="Sales Order">
													<field name="dso_ids" readonly="1">
														<tree editable="top">
															<field name="name" string="No Sales Order"/>
															<field name="date_order"/>
															<field name="partner_id"/>
														</tree>
													</field>
												</page>
											</notebook>
										</group>
									</sheet>
								</form>
							</field>
						</page>
						<page string="Audit Trail">
							<group>
								<group>
									<field name="create_uid" readonly="1"/>
									<field name="create_date" readonly="1"/>
									<field name="approved_am_uid" readonly="1" attrs="{'invisible':[('approved_am_uid','=',False)]}"/>
									<field name="approved_am_date" readonly="1" attrs="{'invisible':[('approved_am_date','=',False)]}"/>
								</group>
								<group>							
									<field name="write_uid" readonly="1"/>
									<field name="write_date" readonly="1"/>
									<field name="approved_operation_uid" readonly="1" attrs="{'invisible':[('approved_operation_uid','=',False)]}"/>
									<field name="approved_aoperation_date" readonly="1" attrs="{'invisible':[('approved_aoperation_date','=',False)]}"/>
								</group>
							</group>
						</page>
					</notebook>
				</form>
			</field>
		</record>
		
		<record id="view_teds_sales_plan_activity_reject_form" model="ir.ui.view">
			<field name="name">teds.sales.plan.activity.reject.form</field>
			<field name="model">teds.sales.plan.activity.line</field>
			<field name="priority">20</field>
			<field name="arch" type="xml">
				<form>
					<sheet>
                        <group>
                        	<field name="reason_reject_location" required="1"/>
                        </group>
                        <footer>
                        	<button name="action_reason_reject" string="Reject" type="object" class="oe_highlight"/>
	                    	<button string="Cancel" class="oe_link" special="cancel"/>
                        </footer>
                    </sheet>
                </form>
            </field>
        </record>

		<record id="view_teds_sales_plan_activity_detail_form" model="ir.ui.view">
			<field name="name">teds.sales.plan.activity.detail.form</field>
			<field name="model">teds.sales.plan.activity.line</field>
			<field name="priority">10</field>
			<field name="arch" type="xml">
				<form>
					<sheet>
                        <group>
							<group>
								<field name="state" invisible="1"/>
								<field name="branch_id" invisible="1"/>
								<field name="jaringan_penjualan" readonly="1"/>
								<field name="act_type_id" options="{'no_open':True,'no_create':True}" readonly="1"/>
								<field name="titik_keramaian_id" options="{'no_open':True,'no_create':True}" readonly="1" domain="[('branch_id','=',branch_id)]"/>
								<field name="ring_id" options="{'no_open':True,'no_create':True}"/>
                          		<field name="name" readonly="1"/>
								<field name="is_location"/>
								<field name="jenis_pengajuan" attrs="{'invisible':[('is_location','=',False)]}" readonly="1"/>
								<field name="location_id" options="{'no_open':True,'no_create':True}" domain="[('id','=',0)]" attrs="{'invisible':[('is_location','=',False)]}" readonly="1"/>
                          		<field name="display_unit" attrs="{'invisible':[('is_location','=',False)]}" readonly="1"/>
								<field name="target_unit" readonly="1"/>
								<field name="target_customer" readonly="1"/>
                          	</group>
                          	<group>
								<label for="start_date" string="Periode"/>
		                        <div>
		                            <field name="start_date" readonly="1" placeholder="Start Date" class="oe_inline"/> - 
		                            <field name="end_date" readonly="1" placeholder="End Date" class="oe_inline"/>
		                        </div>
		                        <field name="pic_id" options="{'no_open':True,'no_create':True}" readonly="1"/>
								<field name="nik"/>
								<field name="job"/>
								<field name="no_telp" readonly="1"/>
								<field name="foto" attrs="{'invisible':[('is_location','=',False)]}" widget="image" img_height="200" width="350" height="200" readonly="1"/>
								<field name="filename_foto" invisible="1"/>
							</group>
						</group>
						<group string="Address">
							<group>
								<field name="street" readonly="1"/>
								<field name="rt" class="oe_inline" readonly="1"/>
								<field name="rw" class="oe_inline" readonly="1"/>
							</group>
							<group>
								<field name="state_id" options="{'no_open':True,'no_create':True}" readonly="1"/>
								<field name="city_id" options="{'no_open':True,'no_create':True}" readonly="1"/>
								<field name="kecamatan_id" options="{'no_open':True,'no_create':True}" readonly="1"/>
								<field name="kelurahan_id" options="{'no_open':True,'no_create':True}" readonly="1"/>
							</group>
						</group>
						<group string="Biaya">
							<field name="total_biaya" readonly="1"/>
							<field name="detail_biaya_ids" string="Detail Biaya" readonly="1">
								<tree editable="bottom">
									<field name="name"/>
									<field name="finco_id" readonly="1" options="{'no_open':True,'no_create':True}"/>
									<field name="tipe"/>
									<field name="amount" readonly="1" sum="Total"/>
									<field name="is_ppn" readonly="1"/>
									<field name="subtotal"/>
									<field name="state" invisible="1"/>
								</tree>
							</field>
						</group>
						<group string="History Activity">
							<field name="qty_customer_last" readonly="1"/>
							<field name="history_location_ids" string="Unit 3 Bulan Terakhir" readonly="1">
								<tree readonly="1">
									<field name="name"/>
									<field name="qty" sum="Total"/>
								</tree>
								<form>
									<sheet>
										<group>
											<field name="name"/>
											<field name="qty"/>
										</group>
										<notebook>
											<page string="Detail Pencapaian">
												<field name="detail_ids" nolabel="1">
													<tree>
														<field name="product_id" options="{'no_open':True,'no_create':True}"/>
														<field name="categ_id" options="{'no_open':True,'no_create':True}"/>
													</tree>
													<form>
														<sheet>
															<group>
																<field name="product_id" options="{'no_open':True,'no_create':True}"/>
																<field name="categ_id" options="{'no_open':True,'no_create':True}"/>
															</group>
														</sheet>
													</form>
												</field>
											</page>
										</notebook>
									</sheet>
								</form>
							</field>
						</group>
						<footer>
							<label string="Activity Plan"/>
						</footer>
					</sheet>
				</form>
			</field>
		</record>

		<record id="teds_sales_plan_activity_filter" model="ir.ui.view">
            <field name="name">teds.sales.plan.activity.filter</field>
            <field name="model">teds.sales.plan.activity</field>
            <field name="arch" type="xml">
                <search string="Search">
                    <field name="name"/>
                    <field name="branch_id"/>
                    <field name='bulan'/>
                    <field name='tahun'/>  
                    <filter string="Draft" name="state_draft" domain="[('state','=','draft')]" />
                    <filter string="Waiting for Approval" name="state_waiting_for_approval" domain="[('state','=','waiting_for_approval')]" />
                    <filter string="Approved" name="state_approved" domain="[('state','=','approved')]"/>
                    <filter string="Open" name="state_open" domain="[('state','=','open')]"/>
					<filter string="Done" name="state_done" domain="[('state','=','done')]"/>

                    <group expand="1" string="Group By">
                        <filter string="Branch" context="{'group_by':'branch_id'}"/>
                        <filter string="Bulan" context="{'group_by':'bulan'}"/>
                    </group>     
                </search>
            </field>
        </record>     

        <record id="action_teds_sales_plan_activity" model="ir.actions.act_window">
            <field name="name">Activity Plan &amp; BTL</field>
            <field name="res_model">teds.sales.plan.activity</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'search_default_state_draft':1,'search_default_state_approved':1,'search_default_state_open':1}</field>
        </record>
        
        <record id="action_teds_sales_plan_activity_tree" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_teds_sales_plan_activity_tree"/>
            <field name="act_window_id" ref="action_teds_sales_plan_activity"/>
        </record>
            
        <record id="action_teds_sales_plan_activity_form" model="ir.actions.act_window.view">
            <field eval="2" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_teds_sales_plan_activity_form"/>
            <field name="act_window_id" ref="action_teds_sales_plan_activity"/>
        </record>

    	<menuitem id="teds_sales_plan_activity_menuitem" action="action_teds_sales_plan_activity" parent="teds_sales_activity_btl_menu" sequence="03"/>

    	<report 
            string="Print Act BTL" 
            id="action_teds_act_btl_print" 
            model="teds.sales.plan.activity" 
            report_type="qweb-pdf"
            name="teds_sales_activity_plan_btl.teds_act_plan_btl_print" 
            file="teds_sales_activity_plan_btl.teds_act_plan_btl_print" 
            menu="False"/>
	</data>
</openerp>