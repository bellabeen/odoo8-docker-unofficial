<?xml version="1.0"?>
<openerp>
	<data>
		<record id="view_teds_sales_plan_activity_approved_tree" model="ir.ui.view">
			<field name="name">teds.sales.plan.activity.approved.tree</field>
			<field name="model">teds.sales.plan.activity.line</field>
			<field name="arch" type="xml">
				<tree create="false" delete="false" colors="blue:state == 'open';">
					<field name="activity_id" string="Activity Plan"/>
					<field name="branch_id"/>
					<field name="jaringan_penjualan"/>
					<field name="name"/>
					<field name="act_type_id" options="{'no_open':True,'no_create':True}"/>
					<field name="ring_id" options="{'no_open':True,'no_create':True}"/>
					<field name="kecamatan_id" options="{'no_open':True,'no_create':True}"/>
					<field name="jenis_pengajuan"/>
					<field name="location_id"/>
					<field name="start_date"/>
					<field name="end_date"/>
					<field name="display_unit"/>
					<field name="total_biaya"/>
					<field name="create_date" string="Create on"/>
					<field name="state"/>
				</tree>
			</field>
		</record>

		<record id="view_teds_sales_plan_activity_approved_form" model="ir.ui.view">
			<field name="name">teds.sales.plan.activity.approved.form</field>
			<field name="model">teds.sales.plan.activity.line</field>
			<field name="priority">1</field>
			<field name="arch" type="xml">
				<form create="false" delete="false">
					<header>
						<button name="action_open_location" string="Approved" type="object" class="oe_highlight" attrs="{'invisible':[('state','!=','open')]}" confirm="Location sudah sesuai ?" groups="teds_sales_activity_plan_btl.group_approved_location_activity_line_button"/>
						<button name="action_reject_location" string="Reject" type="object" class="oe_highlight" attrs="{'invisible':[('state','!=','open')]}" groups="teds_sales_activity_plan_btl.group_reject_location_activity_line_button"/>
						<button name="action_history_result" string="Refresh History" type="object"/>
						<field name="state" invisible="1" />
					</header>
					<sheet>
						<div class="oe_title">
							<h1>
								<field name="name" attrs="{'readonly':[('state','in',('confirmed','done'))]}" required="1"/>	
							</h1>
						</div>
					  	<div class="oe_right oe_button_box" name="buttons">
                    		<button string="Location" class="oe_stat_button" icon="fa-building-o" name="action_view_location" type="object" attrs="{'invisible':['|',('is_location','=',False),('location_id','=',False)]}" groups="teds_sales_activity_plan_btl.group_open_location_activity_line_button"/>
                		</div>
	                    <group>
							<group>
								<field name="activity_id" invisible="1"/>
								<field name="branch_id" readonly="1" options="{'no_open':True,'no_create':True}"/>
								<field name="jaringan_penjualan" readonly="1"/>
								<field name="act_type_id" options="{'no_open':True,'no_create':True}" readonly="1"/>
								<field name="titik_keramaian_id" options="{'no_open':True,'no_create':True}" readonly="1"/>
								<field name="ring_id" options="{'no_open':True,'no_create':True}"/>
								<field name="is_location" readonly="1"/>
								<field name="source_pos_location_id" attrs="{'invisible':['|',('is_location','=',False),('jaringan_penjualan','!=','POS')],'required':[('is_location','!=',False),('jaringan_penjualan','=','POS')],'readonly':[('state','in',('confirmed','done'))]}" options="{'no_open':True,'no_create':True}" domain="[
													('branch_id','=',branch_id),
													('jenis','=','pos'),
													('start_date','&lt;=',context_today().strftime('%Y-%m-%d')),
													('end_date','&gt;=',context_today().strftime('%Y-%m-%d'))
													]"/>
								<field name="jenis_pengajuan" attrs="{'invisible':[('is_location','=',False)],'readonly':[('state','in',('confirmed','done'))],'required':[('is_location','!=',False)]}"/>
								<field name="location_id" options="{'no_open':True,'no_create':True}" domain="[('branch_id','=',branch_id),('usage','=','internal')]" attrs="{'invisible':['|',('jenis_pengajuan','!=','update'),('is_location','=',False)],'required':[('jenis_pengajuan','=','update')],'readonly':[('state','in',('confirmed','done'))]}"/>
	                      		<field name="display_unit" attrs="{'invisible':[('is_location','=',False)],'required':[('is_location','!=',False)],'readonly':[('state','in',('confirmed','done'))]}"/>
								<field name="target_unit" readonly="1"/>
								<field name="target_customer" readonly="1"/>
	                      	</group>
	                      	<group>
								<label for="start_date" string="Periode"/>
		                        <div>
		                            <field name="start_date" required="1" placeholder="Start Date" class="oe_inline"/> - 
		                            <field name="end_date" required="1" placeholder="End Date" class="oe_inline"/>
		                        </div>
		                        <field name="pic_id" options="{'no_open':True,'no_create':True}" readonly="1"/>
								<field name="nik"/>
								<field name="job"/>
								<field name="no_telp" readonly="1"/>
								<field name="foto" attrs="{'invisible':[('is_location','=',False)]}" widget="image" img_height="200" width="350" height="200" filename="filename_foto"/>
								<field name="filename_foto" invisible="1"/>
							</group>
						</group>
						<group string="Address">
							<group>
								<field name="street" attrs="{'readonly':[('state','in',('confirmed','done'))],'required':[('is_location','!=',False)]}"/>
								<field name="rt" class="oe_inline" attrs="{'readonly':[('state','in',('confirmed','done'))]}"/>
								<field name="rw" class="oe_inline" attrs="{'readonly':[('state','in',('confirmed','done'))]}"/>
							</group>
							<group>
								<field name="state_id" options="{'no_open':True,'no_create':True}" readonly="1"/>
								<field name="city_id" options="{'no_open':True,'no_create':True}" readonly="1"/>
								<field name="kecamatan_id" options="{'no_open':True,'no_create':True}"/>
								<field name="kelurahan_id" options="{'no_open':True,'no_create':True}" attrs="{'readonly':[('state','in',('confirmed','done'))]}"/>
							</group>
						</group>
						<group string="Biaya">
							<field name="total_biaya" readonly="1"/>
							<field name="detail_biaya_ids" readonly="1" string="Detail Biaya">
								<tree editable="bottom">
									<field name="name" required="1"/>
									<field name="finco_id" attrs="{'readonly':[('name','!=','Leasing')],'required':[('name','=','Leasing')]}" options="{'no_open':True,'no_create':True}"/>
									<field name="tipe" readonly="1"/>
									<field name="amount" required="1" sum="Total"/>
									<field name="is_ppn" readonly="1"/>
									<field name="subtotal"/>
								</tree>
							</field>
						</group>
						<group string="History Activity">
							<field name="qty_customer_last" readonly="1"/>
							<field name="history_location_ids" readonly="1" string="Unit 3 Bulan Terakhir">
								<tree>
									<field name="name"/>
									<field name="qty" sum="Total"/>
								</tree>
								<form>
									<sheet>
										<group>
											<field name="name"/>
											<field name="qty"/>
										</group>
										<notebook>
											<page string="Detail Pencapaian">
												<field name="detail_ids" nolabel="1">
													<tree>
														<field name="product_id" options="{'no_open':True,'no_create':True}"/>
														<field name="categ_id" options="{'no_open':True,'no_create':True}"/>
													</tree>
													<form>
														<sheet>
															<group>
																<field name="product_id" options="{'no_open':True,'no_create':True}"/>
																<field name="categ_id" options="{'no_open':True,'no_create':True}"/>
															</group>
														</sheet>
													</form>
												</field>
											</page>
										</notebook>
									</sheet>
								</form>
							</field>
						</group>
					</sheet>
				</form>
			</field>
		</record>

		<record id="teds_sales_plan_approved_activity_filter" model="ir.ui.view">
            <field name="name">teds.sales.plan.approved.activity.filter</field>
            <field name="model">teds.sales.plan.activity.line</field>
            <field name="arch" type="xml">
                <search string="Search">
                    <field name="name"/>
                    <field name="activity_id" string="Activity Plan"/>
                    <field name="branch_id"/>
                    <field name='act_type_id'/>
                    <field name='titik_keramaian_id'/>  
                    <field name='pic_id'/>
                    <field name='location_id'/> 
                    <filter string="Open" name="state_open" domain="[('state','=','open')]" />
                    <filter string="Done" name="state_done" domain="[('state','=','done')]"/>
                    <group expand="0" string="Group By">
                        <filter name="group_by_activity" string="Activity Plan" context="{'group_by':'activity_id'}"/>
                    </group>
                </search>
            </field>
        </record>        
        
        <record id="action_teds_sales_plan_approved_activity" model="ir.actions.server">
            <field name="name">Review Location BTL</field>
            <field name="model_id" ref="teds_sales_activity_plan_btl.model_teds_sales_plan_activity_line"/>
            <field name="code">
                action = env['teds.sales.plan.activity.line'].action_teds_sales_plan_actitivty_tree()
            </field>
        </record>


        <report 
            string="Activity BTL" 
            id="action_teds_act_btl_print_tree" 
            model="teds.sales.plan.activity.line" 
            report_type="qweb-pdf"
            name="teds_sales_activity_plan_btl.teds_act_plan_btl_print_tree" 
            file="teds_sales_activity_plan_btl.teds_act_plan_btl_print_tree" 
            menu="True"/>
            
    	<menuitem id="teds_sales_plan_activity_approved_menuitem" action="action_teds_sales_plan_approved_activity" parent="teds_sales_activity_btl_menu" sequence="05"/>

	</data>
</openerp>