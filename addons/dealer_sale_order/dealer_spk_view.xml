<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
	
	<record model="ir.ui.view" id="dealer_reason_spk_cancel_wizard_form">
		    <field name="name">dealer.reason.cancel.spk.wizard</field>
		    <field name="model">dealer.reason.cancel.spk</field>
		    <field name="arch" type="xml">
		        <form string="REASON" version="7.0">
		            <group>
		                <field name="reason"/>
		            </group>
		            <footer>
		                <button name="action_post_cancel" string="Save" type="object" class="oe_highlight"/>
		                or
		                <button string="Cancel" class="oe_link" special="cancel" />
		            </footer>
		        </form>
		    </field>
	</record>
	
	<record model="ir.actions.act_window" id="cancel_spk_wizard_action">
		    <field name="name">Reason Cancel</field>
		    <field name="res_model">dealer.reason.cancel.spk</field>
		    <field name="view_type">form</field>
		    <field name="view_mode">form</field>
		    <field name="target">new</field>
		</record>
		
	<record id="view_spk_tree" model="ir.ui.view">
            <field name="name">dealer.spk.tree</field>
            <field name="model">dealer.spk</field>
            <field name="priority">2</field>
            <field name="arch" type="xml">
                <tree string="Dealer SPK"  colors="grey:state=='cancel';blue:state in ('waiting_date','manual');red:state in ('invoice_except','shipping_except')">
                    <!-- <field name="message_unread" invisible="1"/> -->
                    <field name="name" string="SPK Number"/>
                     <field name="branch_id"/>
                    <field name="date_order"/>
                    <field name="partner_id"/>
                    <field name="user_id"/>
                   <!--  <field name="amount_total" sum="Total Tax Included"/> -->
                    <field name="state"/>
                </tree>
            </field>
     </record>
 		<record id="dealer_spk_dealer_filter" model="ir.ui.view">
            <field name="name">dealer.spk.filter</field>
            <field name="model">dealer.spk</field>
            <field name="arch" type="xml">
                <search string="Search Dealer SPK">
                	<field name="name"/>
                    <field name="partner_id"/>
                    <field name='branch_id'/>
					<field name='division'/>  
					<field name='no_ktp'/>
					<field name='finco_id'/> 
					<field name='user_id'/>  
					<filter string="Draft" name="state_draft" domain="[('state','=','draft')]" />
					<filter string="SPK" name="state_spk" domain="[('state','=','progress')]" />
					<filter string="Sales Order" name="state_so" domain="[('state','=','so')]" />
					<filter string="Done" name="state_done" domain="[('state','=','done')]" />                 	                  
                    <group expand="1" string="Group By">
                        <filter string="Branch" context="{'group_by':'branch_id'}"/>
                    </group> 						  	                  
                </search>
            </field>
        </record>	
	<record id="spk_dealer_form" model="ir.ui.view">
            <field name="name">dealer.spk.form</field>
            <field name="model">dealer.spk</field>            
            <field name="arch" type="xml">
                <form string="Sales Orders"  >
                
                <header>
                	<button name="action_confirm_spk" states="draft" string="Confirm" class="oe_highlight" type="object" groups="base.group_user"/>
                	<button name="%(cancel_spk_wizard_action)d" states="progress" string="Cancel SPK" class="oe_highlight" type="action" groups="base.group_user"/>
                	 <button name="action_create_so" states="progress" string="Create SO" class="oe_highlight" type="object" groups="base.group_user"/>
                	 <button name="action_view_so" states="so" string="View Sales Order" type="object"  class="oe_highlight" groups="base.group_user"/>
                	<field name="state" widget="statusbar" statusbar_visible="draft,progress,so,done" />
                </header>
                <sheet>
                   		<div class="oe_title">                      
		       				<h1>
					            <label string="SPK"/>
					 			<field name="name" class="oe_inline" readonly="1"/>	
		    			    </h1>
	                    </div>
	                    <group>
	                    	<group>
	                   			<field name="branch_id" options="{'no_create': True,'no_open':True}" attrs="{'readonly': [('name','!=',False)]}" class="oe_inline" on_change="branch_change(branch_id)"/>		                    
		                    	<field name="date_order" class="oe_inline" readonly="1"/>
		                    	<field name="partner_id" options="{'no_create': True}" attrs="{'readonly': [('state','not in','draft')]}" class="oe_inline"/>
		                    	<field name="user_id" on_change="user_change(user_id,branch_id)"  options="{'no_create': True,'no_open':True}" attrs="{'readonly': [('state','not in','draft')]}" class="oe_inline" domain="[('branch_ids','in',branch_id)]"/>
		                    	<field name="sales_koordinator_id"  options="{'no_create': True,'no_open':True}" attrs="{'readonly': [('state','not in','draft')], 'required': [('date_order','&gt;=','2016-06-01')]}" class="oe_inline" domain="[('branch_ids','in',branch_id)]"/>
		                   		<field name="finco_id" options="{'no_create': True,'no_open':True}" class="oe_inline" attrs="{'readonly': [('state','not in','draft')]}"/>	 
			                	<field name="alamat_kirim" attrs="{'readonly': [('state','not in','draft')]}"/>
	                    	</group>
	                    	<group>
			                	<field name="division"  class="oe_inline" attrs="{'readonly': [('state','not in','draft')]}"/>
		                    	<field name="no_ktp" attrs="{'readonly': [('state','not in','draft')]}"/>
		                    	<field name="cddb_id" options="{'no_create': True,'no_open':True}" attrs="{'readonly': [('state','not in','draft')]}" class="oe_inline" domain="[('customer_id','=',partner_id)]"/>
		                    	<field name="register_spk_id" options="{'no_create': True,'no_open':True}" attrs="{'readonly': [('state','not in','draft')],'required': [('is_mandatory_spk','=',True)]}" class="oe_inline" domain="[('branch_id','=',branch_id),('sales_id','=',user_id),('state','=','open')]"/>
		                    	<!--field name="section_id"  attrs="{'readonly': [('state','not in','draft')]}" class="oe_inline"/-->
		                    	<field name="sales_source" class="oe_inline" attrs="{'readonly': [('state','not in','draft')]}" required="1"/>
			                	<field name="sales_source_location" options="{'no_create': True,'no_open':True}" class="oe_inline" attrs="{'invisible': [('sales_source','not in',('canvasing','pos','pameran','channel'))], 'required': [('sales_source','in',('canvasing','pos','pameran','channel'))], 'readonly': [('state','!=','draft')]}" domain="[('branch_id','=',branch_id),('jenis','=',sales_source),('start_date','&lt;=',time.strftime('%Y-%m-%d %H:%M:%S')),('end_date','&gt;=',time.strftime('%Y-%m-%d %H:%M:%S'))]" />
			                	<field name="is_mandatory_spk" invisible="1"/>
	                    	</group>	                    	
	                    </group>
                   <notebook >
		                <page string="SPK Detail" >
		                	<field name="dealer_spk_line" attrs="{'readonly': [('state','not in','draft')]}">                    			
		                    		<tree editable="top">
		                    			<field name="categ_id" />
										<field name="product_id" options="{'no_create': True,'no_open':True}" />
		                    			<field name="product_qty" />			
		                    			<field name="is_bbn" />
		                    			<field name="partner_stnk_id" options="{'no_create': True,'no_open':True}" attrs="{'required': [('is_bbn','!=',False),('is_bbn','!=', 'T')]}" />
		                    							                    			 
		                    			<field name="uang_muka"/>
		                    			<field name="discount_po"/>
		                    		</tree>
		                    		
		                    </field>
                             <div class="oe_clear"/>
		                 </page>
						<page string="Audit Trail">
							<group>
								<group>
									<field name="create_uid" readonly="1"></field>
									<field name="create_date" readonly="1"></field>
									<field name="confirm_uid" readonly="1"></field>
									<field name="confirm_date" readonly="1"></field>
								</group>
								<group>							
									<field name="write_uid" readonly="1"></field>
									<field name="write_date" readonly="1"></field>
									<field name="cancel_uid" readonly="1"></field>
									<field name="cancel_date" readonly="1"></field>
								</group>
							</group>
						</page>		                 
		            </notebook>	
                	</sheet>   	                    
                </form>
            </field>
        </record>
        
    	<record model="ir.actions.act_window" id="dealer_spk_action">
		    <field name="name">Dealer SPK</field>
		    <field name="res_model">dealer.spk</field>
		    <field name="view_type">form</field>
		    <field name="view_mode">tree,form</field>
		    <field name="context">{"search_default_state_draft":1,"search_default_state_spk":1}</field>
		    		    
		</record>
		
		
		 <record id="view_spk_report_filter" model="ir.ui.view">
            <field name="name">dealer.spk.list.select</field>
            <field name="model">dealer.spk.report</field>
            <field name="arch" type="xml">
                <search string="Search Dealer SPK">
        			<field name='branch_id'/>
                    <group expand="0" string="Group By">
                        <filter string="Product" icon="terp-partner" domain="[]" context="{'group_by':'product_id'}"/>
                        <filter string="Branch" icon="terp-go-month" domain="[]" context="{'group_by':'branch_id'}"/>
               
                    </group>
                </search>
            </field>
        </record>
        
        
		
		<record id="view_spk_tree_report" model="ir.ui.view">
            <field name="name">dealer.spk.report</field>
            <field name="model">dealer.spk.report</field>
            <field eval="112" name="priority"/>
            <field name="arch" type="xml">
                <tree string="Dealer SPK"  create="false">
                    <field name="branch_id"/>
                    <field name="date"/>
                    <field name="partner_id"/>
                    <field name="finco_id"/>
                    <field name="user_id"/>
                    <field name="product_id"/>
                   
                </tree>
            </field>
        </record>
        
        <record id="action_dealer_spk_report" model="ir.actions.act_window">
            <field name="name">SPK</field>
            <field name="res_model">dealer.spk.report</field>
            <field name="view_id" ref="view_spk_tree_report"/>
            <field name="view_mode">tree_dealer_spk_report</field>
            <field name="search_view_id" ref="view_spk_report_filter"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Select the branch and product you want to fill.
              </p><p>
                Report SPK 
              </p>
            </field>
        </record>

		
       	<menuitem id="menu_dealer_spk_report"  parent="wtc_dealer_menu.showroom_report_menu" sequence="1"  action="action_dealer_spk_report"/>
       	<menuitem action="dealer_spk_action" id="menu_dealer_spk" parent="wtc_dealer_menu.showroom_sales_menu" sequence="2"/>
	</data>
</openerp>