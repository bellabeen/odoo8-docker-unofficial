<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
		<record model="ir.ui.view" id="wtc_sale_order_form_view">
    		<field name="name">wtc.sale.order.form</field>            
    		<field name="model">sale.order</field>            
    		<field name="inherit_id" ref="sale.view_order_form"/>
    		<field name="arch" type="xml">
    		
			<button name="action_button_confirm" position="attributes">
				<attribute name="invisible">1</attribute>
			</button>
    		
			<button name="print_quotation" states="draft" position="attributes">
		    		<attribute name="invisible">1</attribute>
		    </button>
		    
		    <button name="print_quotation" states="sent,progress,manual" position="attributes">
		    		<attribute name="invisible">1</attribute>
		    </button>
		    	
		     <xpath expr="//button[@name='print_quotation']" position="after">
				<button name="%(sale_order_report)d"  type="action" string="Print Invoice" class="oe_highlight"  icon="gtk-print"/>
                <button name="so_unused" states="draft,sent" string="Unused" groups="base.group_user"/>
			</xpath>
			
			
    			
    			<xpath expr="/form/sheet/group" position="before">
		    		<group>
		    			<group>
			            	<field name="branch_id" options="{'no_open':True,'no_create':True}" attrs="{'readonly': ['|',('state','not in','draft'),('name','!=','/')]}" on_change="onchange_branch(branch_id)"/>
			            </group>
			            <group>
							<field name="division" attrs="{'readonly': ['|',('state','not in','draft'),('name','!=','/')]}"/>
						</group>
					</group>		            
		    	</xpath>
    			
    			<field name="partner_id" position = "replace">
					 <field name="partner_id" on_change="onchange_partner_id_new(partner_id, division,context)" context="{'search_default_customer':1, 'show_address': 1}" attrs="{'no_open':True,'no_create_edit':True,'invisible':[('division','=',False)]}"/>
			    </field>
			    			    
			    <field name="partner_id" position = "after">
					 <field name="credit_limit_unit" readonly="True" attrs="{'invisible': [('division','!=','Unit')]}"/>
					 <field name="credit_limit_sparepart" readonly="True" attrs="{'invisible': [('division','!=','Sparepart')]}"/>
					 <field name="total_invoiced_show" readonly="True"/>
					 <field name="total_invoiced" invisible="1"/>
					 <field name="source_location_id" options="{'no_open':True,'no_create':True}" domain="[('usage','=','internal'),('warehouse_id','=',warehouse_id)]" attrs="{'readonly':[('state','not in','draft')],'required':[('division','=','Sparepart')]}"/>
			    </field>
	    		
	    		<field name="pricelist_id" position = "attributes">
					<attribute name = "invisible">1</attribute>
			    </field>
			    
			     <field name="amount_untaxed" position = "after">
					<field name="discount_cash_persen" groups="sale.group_discount_per_so_line" attrs="{'readonly':[('state','not in','draft')]}" on_change="discount_cash_change(discount_cash_persen,amount_untaxed)"/>
					<field name="discount_cash_show" groups="sale.group_discount_per_so_line" invisible="1"/>
					<field name="discount_cash" groups="sale.group_discount_per_so_line" string="Discount Cash" attrs="{'readonly':[('state','not in','draft')]}"/>
					<field name="discount_program" groups="sale.group_discount_per_so_line" attrs="{'readonly':[('state','not in','draft')]}"/>
					<field name="discount_lain" groups="sale.group_discount_per_so_line" attrs="{'readonly':[('state','not in','draft')]}"/>
			    </field>
			    
			    <xpath expr="//field[@name='sequence']" position="after">
					<field name="categ_id" on_change="category_change(categ_id,parent.branch_id,parent.division,parent.pricelist_id)" domain="[('name','=',parent.division)]" options="{'no_open':True,'no_create':True}"/>
				</xpath>
				
				<xpath expr="//field[@name='order_line']" position="attributes">
					<!-- <attribute name="readonly">{'readonly': [('name','!=','/')]}</attribute> -->
				</xpath>
				
				<xpath expr="//field[@name='order_line']/tree//field[@name='name']" position="after">
					<field name="qty_available" invisible="1"/>
					<field name="qty_available_show" readonly="1"/>
				</xpath>
				
				<xpath expr="//field[@name='order_line']/tree//field[@name='product_uom_qty']" position="attributes">
					<attribute name="sum">Total qty</attribute>
				</xpath>
				
				<xpath expr="//field[@name='order_line']/tree//field[@name='price_subtotal']" position="before">
					<field name="hpp_average" groups="wtc_sale_order.group_sale_order_view_hpp_average"/>
				</xpath>
				
				<xpath expr="//field[@name='order_line']/tree//field[@name='product_id']" position="replace">
                     <field name="product_id"
                         context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom}"
                         groups="base.group_user"
                         on_change="product_id_change_dev(parent.division,parent.branch_id,parent.pricelist_id, product_id, product_uom_qty, False, product_uos_qty, 
                         			False, name, parent.partner_id, False, True, parent.date_order, False, 
                         			parent.fiscal_position, False, context)"/>
				</xpath>
				
				<xpath expr="//field[@name='order_line']/tree//field[@name='product_id']" position="attributes">
					<attribute name="options">{'no_open':True,'no_create_edit':True}</attribute>
				</xpath>
				
				<field name="incoterm" position = "attributes">
					<attribute name = "invisible">1</attribute>
			    </field>
			    
			    <field name="client_order_ref" position = "attributes">
					<attribute name = "invisible">1</attribute>
			    </field>
			    
			    
			    <field name="picking_policy" position = "attributes">
					<attribute name = "invisible">1</attribute>
			    </field>
			    
			    <field name="order_policy" position = "attributes">
					<attribute name = "invisible">1</attribute>
			    </field>
			    
			    <field name="fiscal_position" position = "attributes">
					<attribute name = "invisible">1</attribute>
			    </field>
			    
			    <field name="company_id" position = "attributes">
					<attribute name = "invisible">1</attribute>
			    </field>
			    
			    <field name="user_id" position = "replace">
			    </field>
			    
			    <field name="section_id" position = "replace">
			    </field>
			    
			    <field name="origin" position = "replace">
			    </field>
			    
			    <field name="payment_term" position = "replace">
			    </field>
			    
			    <field name="invoiced" position = "replace">
			    </field>
			    
			    <field name="shipped" position = "replace">
			    </field>
			    
			    
			    <field name="incoterm" position = "before">
					<field name="user_id" context="{'default_groups_ref': ['base.group_user', 'base.group_partner_manager', 'account.group_account_invoice', 'base.group_sale_salesman_all_leads']}" attrs="{'readonly':[('state','!=','draft')]}"/>
					<field name="section_id" options="{'no_create': True}" groups="base.group_multi_salesteams" attrs="{'readonly':[('state','!=','draft')]}"/>
                    <field groups="base.group_no_one" name="origin" attrs="{'readonly':[('state','!=','draft')]}"/>
                    <field name="payment_term" options="{'no_create': True}" attrs="{'readonly':[('state','!=','draft')]}"/>
                    <field name="invoiced"/>
                    <field name="shipped"/>
			    </field>
			    
			   <xpath expr="//button[@name='action_button_confirm']" position="after">
					<button name="renew_price" string="Renew Price" type="object" class="oe_highlight" states="draft"/>
				</xpath>
			   <!-- <xpath expr="//page[@string='Other Information']" position="after">
				 		<page string='Faktur Pajak' attrs="{'invisible': [('amount_tax','=',0)]}"  >
				 			<group>
				 				<field name='pajak_gabungan' attrs="{'readonly':[('state','!=','draft')]}"></field>
				 				<field name='faktur_pajak_id' readonly='1'></field>
				 			</group>
				 		</page>							    
						<page string="Audit Trail">
							<group>
								<group>
									<field name="create_uid" readonly="1"></field>
									<field name="create_date" readonly="1"></field>
									<field name="confirm_uid" readonly="1"></field>
									<field name="confirm_date" readonly="1"></field>
								</group>
								<group>							
									<field name="write_uid" readonly="1"></field>
									<field name="write_date" readonly="1"></field>
									<field name="cancel_uid" readonly="1"></field>
									<field name="cancel_date" readonly="1"></field>
								</group>
							</group>
						</page>	
				</xpath> -->
				<field name="note" position="attributes">
		        	<attribute name="attrs">{'readonly': [('state','not in','draft')]}</attribute>
		        </field>								
	    	</field>
    	</record>
    	
    	<record model="ir.ui.view" id="wtc_sale_order_tree_view">
    		<field name="name">wtc.sale.order.tree</field>            
    		<field name="model">sale.order</field>            
    		<field name="inherit_id" ref="sale.view_order_tree"/>
    		<field name="arch" type="xml">
    			 <field name="partner_id" position="after">
    			 	<field name="division"/>
    			 </field>
    			 
    		</field>
    	</record>
    	
    	<!-- Tambah readonly fields -->
    	<record model="ir.ui.view" id="wtc_sale_order_inherit_warehouse_form_view">
    		<field name="name">wtc.sale.order.inherit.warehouse.form</field>            
    		<field name="model">sale.order</field>            
    		<field name="inherit_id" ref="sale_stock.view_order_form_inherit"/>
    		<field name="arch" type="xml">
                <field name="warehouse_id" position="attributes">
		        	<attribute name="attrs">{'readonly': [('state','not in','draft')]}</attribute>
		        </field>	
    		</field>
    	</record>

        <record id="sale.action_orders" model="ir.actions.act_window">
            <field name="domain">[]</field>
        </record>

		<record id="action_quotations2" model="ir.actions.act_window">
            <field name="name">Quotations</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="sale.view_quotation_tree"/>
            <field name="view_mode">tree,form,calendar,graph</field>
            <!-- <field name="context">{'search_default_my_sale_orders_filter': 1}</field> -->
            <field name="domain">[('state','in',('draft','sent','cancel','waiting_for_approval','approved'))]</field>
            <field name="search_view_id" ref="sale.view_sales_order_filter"/>
		</record>
    	
        <menuitem action="sale.action_orders" id="menu_sale_order_showroom" parent="wtc_dealer_menu.showroom_sales_menu" sequence="4"/>
        <menuitem action="sale.action_orders" id="menu_sale_order_workshop" parent="wtc_dealer_menu.workshop_sales_menu" sequence="4"/>
        <menuitem action="action_quotations2" id="menu_quotation_workshop" parent="wtc_dealer_menu.showroom_sales_menu" sequence="4"/>
        <menuitem action="action_quotations2" id="menu_quotation_showroom" parent="wtc_dealer_menu.workshop_sales_menu" sequence="4"/>
        	        
        	        	    	    	
   	</data>
</openerp>
	    