<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data> 
        <record id="wtc_purchase_asset_form" model="ir.ui.view">
            <field name="name">wtc.purchase.asset.form</field>
            <field name="model">wtc.purchase.asset</field>
            <field name="arch" type="xml">
                <form string="Purchase Asset">
                <header>
					<button name="request_approval" groups='wtc_purchase_asset.group_purchase_asset_rfa' states='draft' string="RFA" type="object" class="oe_highlight"/>
					<button name="approve_approval" states='waiting_for_approval' string="Approve" type="object" class="oe_highlight"/>
					<button name="%(wtc_approval.wtc_approval_reject_wizard_action)d" states='waiting_for_approval' string="Reject" type="action"
						context="{'model_name':'wtc.purchase.asset','update_value':{'approval_state':'r','state':'draft'}}"/>
					<button name="%(wtc_approval.wtc_approval_cancel_wizard_action)d" states='waiting_for_approval' 
						string="Cancel Approval" type="action" context="{'model_name':'wtc.purchase.asset','update_value':{'approval_state':'b','state':'draft'}}"/>
					<button name="confirm_order" groups='wtc_purchase_asset.group_purchase_asset_confirm' type="object" string='Confirm' states='approved' class="oe_highlight"/>
                    <button name="view_invoice"  type="object" states="confirmed" string="View Invoice" class="oe_highlight" />
					<button name="%(wtc_approval.wtc_cancel_approval_wizard)d"  states="approved" string="Cancel Approval" type="action"  
					groups="wtc_purchase_asset.group_purchase_asset_cancel_app" 
					context="{'model_name':'wtc.purchase.asset','update_value':{'approval_state':'b','state':'draft'}}"/>	 																
                    																																					                    
                	<field name="state" widget="statusbar" statusbar_visible="draft,waiting_for_approval,approved,confirmed"/>
                </header>
                <sheet string="Purchase Asset">
                    <div class="oe_title">
                        <h1>
                            <label string="Purchase Asset"/>
                            <field name="name" class="oe_inline" readonly='1'/>
                        </h1>
                    </div>
                    
                   <group>
						<group>
							<field name="branch_id" options="{'no_create': True,'no_open': True}" attrs="{'readonly': ['|',('state','!=','draft'),('name','!=',False)]}" />
						</group>  
						<group>
							<field name="division" attrs="{'readonly': [('state','!=','draft')]}" />																
						</group>                   	
                        <group>
                            <field name="partner_id" string="Supplier" options="{'no_create': True,'no_open': True}" attrs="{'readonly': [('state','!=','draft')]}"/>
                            <field name="supplier_invoice_number" required='1' attrs="{'readonly': [('state','!=','draft')]}"/>
                            <field name="journal_id" options="{'no_create': True,'no_open': True}" invisible='1'/>    
                            <field name='approval_state' attrs="{'readonly': [('state','!=','draft')]}" readonly='1'/>                      	                            
                       		<field name='payment_term_id' required='1' attrs="{'readonly': [('state','!=','draft')]}"/> 
                       </group>
                        <group>
                            <field name="date" readonly='1' />
							<field name='document_date' attrs="{'readonly': [('state','!=','draft')]}"/>                            
                            <field name="date_due" readonly='1'/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Details">
                            <field name="purchase_asset_line">
                                <tree string="Purchase Asset lines" editable="top">
                                	<field name="branch_id" options="{'no_create': True,'no_open': True}"
										 on_change='onchange_branch(branch_id)'/>                                	
                                    <field name="asset_register_id" domain="[('branch_id','=',branch_id)]"
                                    	on_change='onchange_line(asset_register_id,quantity)'/>
									<field name="do_number" attrs="{'required':[('do_date','!=',False)]}"/>
									<field name="do_date" attrs="{'required':[('do_number','!=',False)]}"/>
                                    <field name="product_id"/>
                                    <field name="description"/>
                                    <field name="asset_name"/>
                                    <field name="quantity" readonly='1'/>
                                    <field name="current_value"/>
                                    <field name="amount" />
                                    <field name="tax_id" widget="many2many_tags"/>
									<field name='price_subtotal' readonly='1'/>                                    
                                </tree>
                            </field>
                            <group class="oe_subtotal_footer oe_right">
                                <field name="amount_untaxed" widget="monetary"/>
                                <div>
                                    <label for="amount_tax"/>
                                </div>                                
                                <field name="amount_tax" nolabel="1" widget="monetary"/>
                                <field name="amount_total" class="oe_subtotal_footer_separator" widget="monetary"/>
                            </group>
                        </page>
                        <page string='Faktur Pajak' attrs="{'invisible': [('amount_tax','=',0)]}">
                        	<group>
                        		<field name="pajak_gabungan" on_change='onchange_pajak_gabungan(pajak_gabungan)' attrs="{'required': [('amount_tax','!=',0),'|',('no_faktur_pajak','=',False),('tgl_faktur_pajak','=',False)]}"/>
                        		<field name='no_faktur_pajak' attrs="{'invisible': [('pajak_gabungan','=',True)],'required': [('amount_tax','!=',0),('pajak_gabungan','=',False)]}"></field>
                        		<field name='tgl_faktur_pajak' attrs="{'invisible': [('pajak_gabungan','=',True)],'required': [('amount_tax','!=',0),('pajak_gabungan','=',False)]}"></field>
                        	</group>
                        </page>
						<page string="Approval">
							<field name="approval_ids">
								<tree string="Approval" editable="bottom" create="false" edit="false" delete="false" >
									<field name="group_id" />
									<field name="branch_id"/>
									<field name="division"/>
									<field name="product_template_id"/>
									<field name="limit"/>
									<field name="sts"/>
									<field name="reason"/>
									<field name="pelaksana_id"/>
									<field name="tanggal"/>
								</tree>
							</field>
						</page>
						<page string="Audit Trail">
							<group>
								<group>
									<field name="create_uid" readonly="1"></field>
									<field name="create_date" readonly="1"></field>
									<field name="confirm_uid" readonly="1"></field>
									<field name="confirm_date" readonly="1"></field>
								</group>
								<group>							
									<field name="write_uid" readonly="1"></field>
									<field name="write_date" readonly="1"></field>
									<field name="cancelled_uid" readonly="1"></field>
									<field name="cancelled_date" readonly="1"></field>
								</group>
							</group>
						</page>	                        
	                    <div class="oe_clear">
	                        <label for="comment"/>
	                    </div>
	                    <field name="comment" class="oe_inline" placeholder="Additional notes..."/>                        
                    </notebook>
                </sheet>
                </form>
            </field>
        </record>
        
		<record model="ir.ui.view" id="wtc_purchase_asset_tree">
		    <field name="name">wtc.purchase.asset.tree</field>
		    <field name="model">wtc.purchase.asset</field>
		    <field name="arch" type="xml">		    		        	
                <tree string="Purchase Asset">
	                <field name="name"/>
	                <field name="branch_id"/>
					<field name="division"/>
					<field name="partner_id"/>
					<field name="state"/>               
                </tree>
		     </field>
		</record>        
				
       <record id="wtc_purchase_asset_search" model="ir.ui.view">
            <field name="name">wtc.purchase.asset.search</field>
            <field name="model">wtc.purchase.asset</field>
            <field name="arch" type="xml">
                <search string="Search">
                   <field name='name'/>
	                <field name="branch_id"/>
					<field name="division"/>
					<filter string="Waiting for Approval" name="state_wfa" domain="[('state','=','waiting_for_approval')]" />                                   	               
                </search>
            </field>
        </record>
        		
		<record model="ir.actions.act_window" id="wtc_purchase_asset_action2">
		    <field name="name">Purchase Asset</field>
		    <field name="res_model">wtc.purchase.asset</field>
		    <field name="view_type">form</field>
		    <field name="view_mode">tree,form</field>
		    <field name="search_view_id" ref="wtc_purchase_asset_search"/>
		    <field name="context">{"search_default_state_wfa":1}</field>
		</record>
		        	
		<menuitem action="wtc_purchase_asset_action2" id="menu_wtc_purchase_asset_form2" parent="wtc_dealer_menu.ga_purchase_menu" sequence="20"/>
					
	</data>
</openerp>        
