<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
    
    	 <record id="view_wtc_settlement_tree" model="ir.ui.view">
            <field name="name">wtc.settlement.tree</field>
            <field name="model">wtc.settlement</field>
            <field name="arch" type="xml">
                <tree string="Settlement">
                	<field name="name"/>
	                <field name="advance_payment_id"/>
	                <field name="user_id"/>
	                <field name="date"/>
	                <field name="state"/>
	                
                </tree>
            </field>
        </record>
 		<record id="view_settlement_search" model="ir.ui.view">
            <field name="name">wtc.settlement.select</field>
            <field name="model">wtc.settlement</field>
            <field name="arch" type="xml">
                <search string="Search Settlement">
                    <field name="name" string="Reference"/>
                    <field name='division'/>
                    <field name="advance_payment_id"/> 
                    <field name="branch_id"/> 
                    <field name="user_id"/> 
                    <field name="payment_method"/> 
                    <group expand="0" string="Group By">
                        <filter string="Branch" icon="terp-partner" domain="[]" context="{'group_by':'branch_id'}"/>
                        <filter string="Tanggal" icon="terp-go-month" domain="[]" context="{'group_by':'date'}"/>                    
                    </group>
                </search>
            </field>
        </record>	        
        <record id="view_wtc_settlement_form" model="ir.ui.view">
            <field name="name">wtc.settlement.form</field>
            <field name="model">wtc.settlement</field>
            <field name="arch" type="xml">
                <form string="Settlement">
                	<header>
                		<button name="confirm" states="approved" string="Confirm" type="workflow" class="oe_highlight"/>
                		<!--  <button name="%(report_settlement)d" states="draft,done" type="action" string="Print Draft" class="oe_highlight"  icon="gtk-print"/> -->
                         <button name="print_y" type="object" icon="gtk-print" states="draft,done" string="Print Draft" class="oe_highlight" />

                		 <!-- <button name="%(report_settlement_done)d" type="action" states="done" string="Print Done" class="oe_highlight"  icon="gtk-print"/> -->
                         <button name="print_x" type="object" icon="gtk-print" states="done" string="Print Done" class="oe_highlight" />
                         <button name="action_klik_payment" type="object" class="oe_highlight" string="Payment Klik" attrs="{'invisible':['|',('state','not in',('approved','done')),('payment_klik_uid','!=',False)]}" groups="wtc_advance_payment.group_wtc_advance_payment_is_payment"/>
                		<field name="state" widget="statusbar" statusbar_visible="draft,approved,done"/>
                	</header>
        			<sheet>
                   		<div class="oe_title">                      
		       				<h1>
					            <label string="Settlement"/>
					 			<field name="name" class="oe_inline" readonly="1"/>	
		    			    </h1>
	                    </div>
	                    <group >
	                   		<group col="4">
	                   			<field name="advance_payment_id" on_change="onchange_avp_id(advance_payment_id)" class="oe_inline" options="{'no_create': True,'no_open':True}" domain="[('state','=','confirmed')]" attrs="{'readonly': [('state','not in','draft')]}"/>
		                   		<field name="date" readonly='1' class="oe_inline"/>
			                	 <field name="type" class="oe_inline" attrs="{'readonly': [('state','not in','draft')]}"/>
			                 </group>
			                 
			                 
			               	
		                 </group>
		                 <group col="4">
		                   		<field name="branch_id" options="{'no_create': True,'no_open':True}" attrs="{'readonly': [('name','!=',False)]}" class="oe_inline"/>
		                   		<field name="division" options="{'no_create': True,'no_open':True}" attrs="{'readonly': [('state','not in','draft')]}" class="oe_inline"/>		                   		
		                   		<field name="user_id" options="{'no_create': True,'no_open':True}" attrs="{'readonly': [('state','not in','draft')]}" class="oe_inline"/>
		                   		<field name="account_avp_id" invisible="1"/>
		                   		<field name="payment_method" domain="[('type','in',['bank', 'cash'])]" attrs="{'readonly': [('state','not in','draft')]}" options="{'no_create': True,'no_open':True}" class="oe_inline"/>
		                   		<field name="amount_avp" invisible="1" />
		                   		<field name="amount_avp_show" readonly="1"/>
			                	<field name="description" coslpan="2" attrs="{'readonly': [('state','not in','draft')]}"/>
			                	<field name="is_payment" readonly="1"/>
                                <field name="payment_klik_uid" readonly="1" attrs="{'invisible':[('payment_klik_uid','=',False)]}" options="{'no_open':True,'no_create':True}"/>
                                <field name="payment_klik_date" readonly="1" attrs="{'invisible':[('payment_klik_date','=',False)]}"/>
			              </group>
		                 <notebook>
		                 	<page string="Settlement Detail">
		                 		<field name="settlement_line" attrs="{'readonly': [('state','not in','draft')]}">
		                 			<tree editable="top">
                                        <field name="branch_id" options="{'no_create': True,'no_open':True}" class="oe_inline"/>
		                 				<field name="account_id" options="{'no_create': True,'no_open':True}"/>
		                 				<field name="amount" on_change="onchange_amount(amount,parent.type,parent.amount_avp)"/>
		                 			</tree>
		                 		</field>
		                 	</page>
		                 </notebook>
		                <group class="oe_subtotal_footer oe_right" colspan="2" name="Total">
                           	
                           
                           	<field name="amount_total" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                           	<div class="oe_subtotal_footer_seperator oe_inline">
                           	<label for="amount_gap"/>
                           	</div>
                           	<field name="amount_gap" nolabel="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                           	
                           
                         </group> 
                         <div class="oe_clear"/>
	            	</sheet>
        		</form>
     		</field>
    	</record>
    	
    	
    	<!--record forcecreate="True" model="ir.property" id="property_journal_settlement">
		    <field name="name">property_journal_settlement</field>
		    <field name="fields_id" search="[('model','=','wtc.settlement'),
		      ('name','=','journal_id')]"/>
		    <field name="value" eval="'account.journal,'+str(10)"/>
		</record-->
    	
    	<record model="ir.actions.act_window" id="wtc_settlement">
		    <field name="name">Settlement Advance Payment</field>
		    <field name="res_model">wtc.settlement</field>
		    <field name="view_type">form</field>
		    <field name="view_mode">tree,form</field>
		</record>

        <menuitem id="wtc_settlement_menuitem" name="Settlement Advance Payment" parent="wtc_dealer_menu.backoffice_nontrade_menu" action="wtc_settlement" sequence="20"/>



        <report 
            id="report_advance_payment_done"
            string="Advance_payment_Done"
            model="wtc.settlement" 
            report_type="qweb-pdf"
            file="wtc_advance_payment.settlement_done" 
            name="wtc_advance_payment.settlement_done" 
        />

        <report 
            id="report_advance_payment_draft"
            string="Advance_payment_Draft"
            model="wtc.settlement" 
            report_type="qweb-pdf"
            file="wtc_advance_payment.settlement_draft" 
            name="wtc_advance_payment.settlement_draft" 
        />
	
    </data>
</openerp>