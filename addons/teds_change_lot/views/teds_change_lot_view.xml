<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data> 
    	
		<record model="ir.ui.view" id="teds_change_lot_tree_view">
		    <field name="name">teds.change.lot.tree.view</field>
		    <field name="model">teds.change.lot</field>
		    <field name="arch" type="xml">
		        <tree string="List Change Lot">
		        	<field name="name"/>
		            <field name="branch_id"/>
					<field name="division"/>            		            			            	
		            <field name="date"/>
		            <field name="lot_id"/>
		            <field name="old_chassis_no" string="Current Chassis No"/>
		            <field name="new_chassis_no" string="New Chassis No"/>
		            <field name='state'/>
		        </tree>
		     </field>
		</record>
		    	
		<record model="ir.ui.view" id="teds_change_lot_form_view">
		    <field name="name">teds.change.lot.form.view</field>
		    <field name="model">teds.change.lot</field>
		    <field name="arch" type="xml">		       	        	
				<form string="Form Change Lot">
					<header>
						<button name="action_confirm"
								groups="teds_change_lot.group_change_lot_confirm"
								type="object" string='Confirm' states='approved' class="oe_highlight"/>

						<button name="action_request"
								groups="teds_change_lot.group_change_lot_rfa"
								states="draft" string="RFA" type="object" class="oe_highlight"/>

						<button name="action_approve"
								states="waiting_for_approval" string="Approve" type="object" class="oe_highlight"/>

						<button name="%(wtc_approval.wtc_approval_reject_wizard_action)d"
								attrs="{'invisible': [('state','!=','waiting_for_approval')]}"
								string="Reject"
								type="action"
								context="{'model_name':'teds.change.lot',
										  'update_value':{'approval_state':'r','state':'draft'}}"/>

						<button name="%(wtc_approval.wtc_approval_cancel_wizard_action)d"
								attrs="{'invisible': [('state','!=','waiting_for_approval')]}"
							    string="Cancel Approval"
								type="action"
								context="{'model_name':'teds.change.lot',
										  'update_value':{'approval_state':'b','state':'draft'}}"/>

						<button name="%(wtc_approval.wtc_cancel_approval_wizard)d"
								groups='teds_change_lot.group_change_lot_cancel_app'
								states="approved"
								string="Cancel Approval"
								type="action"
								context="{'model_name':'teds.change.lot',
										  'update_value':{'approval_state':'b','state':'draft'}}"/>

						<field name="state" widget="statusbar" statusbar_visible="draft,waiting_for_approval,confirm"/>	
	           		</header>
					<sheet>  
	        			<div class="oe_title">
			        		<h2>
				                <label string="Change Data Serial Number"/>    			
				 				<field name="name" class="oe_inline" readonly='1'/>
			 				</h2>
	 					</div>			        							        	 
						<group col="2" colspan="2">   
							<group>
								<field name="branch_id" required='1' options="{'no_create': True,'no_open': True}" attrs="{'readonly': ['|',('state','!=','draft'),('name','!=',False)]}" />
							</group>  
							<group>
								<field name="division" required="1" attrs="{'readonly': [('state','!=','draft')]}" />
							</group>
							<group>
								<field name="lot_id" required="1" attrs="{'readonly': [('state','!=','draft')]}" options="{'no_create': True,'no_open': True}"/>
							</group>
							<group>
								<field name="date" readonly="1"/>
							</group>
						</group>
	                    <notebook>
							<page string="Data Serial Number">
								<group>
									<group string="Current">
										<field name="old_partner_id" invisible="1" options="{'no_create': True,'no_open': True}" />
										<field name="old_partner_name" invisible="1"  />
										<field name="old_customer_stnk_id" options="{'no_create': True,'no_open': True}" invisible="1"/>
										<field name="old_no_stnk" invisible="1"/>
										<field name="old_no_bpkb" invisible="1"/>
										<field name="old_no_polisi" invisible="1"/>
										<field name="old_name" invisible="1"/>
										<field name="old_chassis_no" invisible="1"/>
										<field name="old_no_notice" invisible="1"/>
										<field name="old_no_faktur" invisible="1"/>

										<field name="old_related_partner_id" attrs="{'invisible': [('lot_id','=',False)]}" options="{'no_create': True,'no_open': True}" readonly="1"/>
										<field name="old_related_partner_name" attrs="{'invisible': [('lot_id','=',False)]}" readonly="1"  />
										<field name="old_related_customer_stnk_id" options="{'no_create': True,'no_open': True}" attrs="{'invisible': [('lot_id','=',False)]}" readonly="1"/>
										<field name="old_related_no_stnk" attrs="{'invisible': [('lot_id','=',False)]}" readonly="1"/>
										<field name="old_related_no_bpkb" attrs="{'invisible': [('lot_id','=',False)]}" readonly="1"/>
										<field name="old_related_no_polisi" attrs="{'invisible': [('lot_id','=',False)]}" readonly="1"/>
										<field name="old_related_name" attrs="{'invisible': [('lot_id','=',False)]}" readonly="1"/>
										<field name="old_related_chassis_no" attrs="{'invisible': [('lot_id','=',False)]}" readonly="1"/>
										<field name="old_related_no_notice" attrs="{'invisible': [('lot_id','=',False)]}" readonly="1"/>
										<field name="old_related_no_faktur" attrs="{'invisible': [('lot_id','=',False)]}" readonly="1"/>
									</group>
									<group string="New" attrs="{'readonly': [('state','!=','draft')],'invisible': [('lot_id','=',False)]}">
										<field name="new_partner_id" attrs="{'readonly':[('state','!=','draft')],'invisible': [('lot_id','=',False)]}" options="{'no_create': True,'no_open': True}" />
										<field name="new_partner_name" attrs="{'readonly':[('state','!=','draft')],'invisible': [('lot_id','=',False)]}" />
										<field name="new_customer_stnk_id" options="{'no_create': True,'no_open': True}" attrs="{'readonly': [('state','!=','draft')],'invisible': [('lot_id','=',False)]}"/>
										<field name="new_no_stnk" attrs="{'readonly': [('state','!=','draft')],'invisible': [('lot_id','=',False)]}"/>
										<field name="new_no_bpkb" attrs="{'readonly': [('state','!=','draft')],'invisible': [('lot_id','=',False)]}"/>
										<field name="new_no_polisi" attrs="{'readonly': [('state','!=','draft')],'invisible': [('lot_id','=',False)]}"/>
										<field name="new_name" attrs="{'readonly': [('state','!=','draft')],'invisible': [('lot_id','=',False)]}"/>
										<field name="new_chassis_no" attrs="{'readonly': [('state','!=','draft')],'invisible': [('lot_id','=',False)]}"/>
										<field name="new_no_notice" attrs="{'readonly': [('state','!=','draft')],'invisible': [('lot_id','=',False)]}"/>
										<field name="new_no_faktur" attrs="{'readonly': [('state','!=','draft')],'invisible': [('lot_id','=',False)]}"/>
									</group>
								</group>
								<field name="note" placeholder="Add an internal note..." class="oe_inline" attrs="{'readonly': [('state','!=','draft')],'invisible': [('lot_id','=',False)]}"/>
								<div class="oe_clear"/>
							</page>
							<page string="Approval">
								<group>
									<field name="approval_state" readonly='1'/>
								</group>
								<field name="approval_ids">
									<tree string="Approval" editable="bottom" create="false" edit="false" delete="false" >
										<field name="group_id" />
										<field name="branch_id"/>
										<field name="division"/>
										<field name="limit"/>
										<field name="sts"/>
										<field name="reason"/>
										<field name="pelaksana_id"/>
										<field name="tanggal"/>
									</tree>
								</field>
							</page> 	                        
							<page string="Audit Trail">
								<group>
									<group>
										<field name="create_uid" readonly="1"/>
										<field name="create_date" readonly="1"/>
										<field name="confirm_uid" readonly="1"/>
										<field name="confirm_date" readonly="1"/>										
									</group>
									<group>							
										<field name="write_uid" readonly="1"/>
										<field name="write_date" readonly="1"/>
									</group>
								</group>
							</page>	                                              
	                    </notebook>

					</sheet>
					<div class="oe_chatter">
	                    <field name="message_follower_ids" widget="mail_followers"/>
	                    <field name="message_ids" widget="mail_thread"/>
	                </div>
				</form>	
		    </field>
		</record>
		
 		<record model="ir.ui.view" id="teds_change_lot_search_view">
            <field name="name">teds.change.lot.search.view</field>
            <field name="model">teds.change.lot</field>
            <field name="arch" type="xml">
                <search string="Search Change Lot">
                    <field name="name" string="Reference"/>
                    <field name="branch_id"/> 
                    <field name='division'/>
                    <filter name="Outstanding"
							string="Outstanding"
							domain="[('state','in',('draft','waiting_for_approval'))]"/>
                </search>
            </field>
        </record>

		<record model="ir.actions.act_window" id="teds_change_lot_action">
		    <field name="name">Change Data Serial Number</field>
		    <field name="res_model">teds.change.lot</field>
		    <field name="view_type">form</field>
		    <field name="view_mode">tree,form</field>
		    <field name="search_view_id" ref="teds_change_lot_search_view"/>
		    <field name="context">{"search_default_Outstanding":1}</field>		
		</record>
					
		<menuitem id="teds_change_lot_menu"
				  name="Change Data"
				  parent="wtc_dealer_menu.stnk_bpkb_top_menu"
				  sequence="45"/>

		<menuitem id="teds_change_lot_submenu"
				  name="Change Data Serial Number"
				  parent="teds_change_lot_menu"
				  action="teds_change_lot_action"
				  sequence="10"/>
        	        		
	</data>
</openerp>
