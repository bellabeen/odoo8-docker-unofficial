<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
    <!-- Reject budget proposal -->
        <record id="view_teds_proposal_budget_reject_form" model="ir.ui.view">
            <field name="name">teds.proposal.budget.reject.form.view</field>
            <field name="model">teds.proposal.budget.reject</field>
            <field name="arch" type="xml">
                <form string="Alasan Reject">
                    <group>
                        <field name="proposal_id" invisible="1" />
                        <field name="reject_reason" required="1" />
                    </group>
                    <footer>
                        <button name="action_reject" string="Reject" type="object" class="oe_highlight"/>
                        or
                        <button string="Discard" class="oe_link" special="cancel" />
                    </footer>
                </form>
            </field>
        </record>
    <!-- Proposal -->
        <record id="view_teds_proposal_tree" model="ir.ui.view" >
            <field name="name">teds.proposal.tree</field>
            <field name="model">teds.proposal</field>
            <field name="arch" type="xml">
            	<tree string="Proposal" colors="red:budget_state=='over'">
            		<field name="name" />
                    <field name="department_id" />
                    <!-- <field name="act_budget_id" />
                    <field name="act_budget_activity" /> -->
                    <field name="state" />
                    <field name="amount_total" />
                    <field name="amount_paid" />
                    <field name="budget_state" />
            	</tree>
            </field>
        </record>
        
        <record id="view_teds_proposal_form" model="ir.ui.view" >
            <field name="name">teds.proposal.form</field>
            <field name="model">teds.proposal</field>
            <field name="arch" type="xml">
            	<form string="Proposal">
            		<header>
                        <button name="action_rfa" string="RFA" states="draft" type="object" class="oe_highlight" groups="teds_proposal.group_button_rfa_proposal"/>
                        <button name="action_approved" string="Approve" type="object" attrs="{'invisible': [('state','!=','rfa')]}" class="oe_highlight" />
                        <button name="action_reject_form" string="Reject" type="object" attrs="{'invisible': [('state','!=','rfa')]}" />
                        <button name="action_revise" string="Revise" type="object" attrs="{'invisible': ['|',('state','!=','reject'),'&amp;',('state','=','reject'),'|',('amount_paid','>',0),('amount_reserved','>',0)]}" class="oe_highlight" groups="teds_proposal.group_button_rfa_proposal" />
                        <!-- <button name="action_close_proposal" string="Close Proposal" type="object" attrs="{'invisible': [('state','in',('draft','close','done '))]}" groups="teds_proposal.group_button_close_proposal" /> -->
                        <button name="action_print_proposal" string="Print Proposal" type="object" attrs="{'invisible': [('is_print_prop_ok','=',False)]}" groups="teds_proposal.group_button_print_proposal" />
                        <field name="state" widget="statusbar" statusbar_visible="draft,rfa,approved,done" readonly="1" />
                    </header>
            		<sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1" attrs="{'invisible': [('name','=',False)]}" class="oe_inline" />
                            </h1>
                        </div>
						<group>
                            <group>
                                <field name="branch_id" required="1" attrs="{'readonly': ['|',('state','!=','draft'),('name','!=',False)]}" options="{'no_create': True, 'no_open': True}" />
                                <!-- <field name="act_budget_id" required="1" attrs="{'readonly': [('state','!=','draft')]}" options="{'no_create': True, 'no_open': True}" /> -->
                                <!-- <field name="act_budget_activity" readonly="1" /> -->
                                <field name="event" required="1" attrs="{'readonly': [('state','!=','draft')]}" />
                                <field name="kode_budget" required="1" attrs="{'readonly': [('state','!=','draft')]}" />
                                <field name="approval_state" invisible="1" />
                                <field name="amount_approved" readonly="1" attrs="{'invisible': [('amount_approved','&lt;=',100)]}" />
                                <field name="is_print_prop_ok" invisible="1" />
                                <field name="is_coo" invisible="1" />
                            </group>
                            <group>
                                <field name="date_proposal" readonly="1" />
                                <field name="division" required="1" attrs="{'readonly': [('state','!=','draft')]}" />
                                <field name="pic_id" required="1" attrs="{'readonly': [('state','!=','draft')]}" options="{'no_create': True, 'no_open': True}" />
                                <field name="department_id" readonly="1" required="1" options="{'no_create': True, 'no_open': True}" />
                                <field name="budget_state" readonly="1" attrs="{'invisible': [('state','=','draft')]}" />
                                <field name="is_penyimpangan" attrs="{'readonly': ['|',('is_coo','=',False),'&amp;',('state','!=','rfa'),('is_coo','!=',False)], 'invisible': [('amount_total','&lt;=',10000000)]}" />
                            </group>
                        </group>
                        <group>
                            <field name="latar_belakang" required="1" attrs="{'readonly': [('state','!=','draft')]}" colspan="4" />
                            <field name="tujuan" required="1" attrs="{'readonly': [('state','!=','draft')]}" colspan="4" />
                            <field name="what" required="1" attrs="{'readonly': [('state','!=','draft')]}" colspan="4" />
                            <field name="how" required="1" attrs="{'readonly': [('state','!=','draft')]}" colspan="4" />
                        </group>
                        <notebook>
                            <page string="Detail">
                                <field name="item_ids" nolabel="1" attrs="{'readonly':[('state','!=','draft')]}">
                                    <tree editable="top">
                                        <field name="description" required="1" />
                                        <field name="qty" required="1" />
                                        <field name="price_unit" required="1" />
                                        <field name="amount_total" string="Total" sum="Total" readonly="1" />
                                        <field name="jenis_pembayaran" required="1" />
                                        <field name="cash_remark" attrs="{'required': [('jenis_pembayaran','=','C')], 'readonly': [('jenis_pembayaran','=','T')]}" />
                                        <field name="supplier_id" domain="[('supplier','!=',False)]" attrs="{'required': [('jenis_pembayaran','=','T')], 'readonly': [('jenis_pembayaran','=','C')]}" options="{'no_open':True, 'no_create': True}" />
                                        <field name="amount_reserved" sum="Total" readonly="1" />
                                        <field name="amount_paid" sum="Total" readonly="1" />
                                    </tree>
                                    <form>
                                        <sheet>
                                            <div class="oe_title">
                                                <h1>
                                                    <field name="description" readonly="1" />
                                                </h1>
                                            </div>
                                            <group>
                                                <group>
                                                    <field name="qty" readonly="1" style="width: 100%%" />
                                                    <field name="price_unit" readonly="1" style="width: 100%%" />
                                                    <field name="amount_total" readonly="1" />
                                                    <field name="amount_reserved" readonly="1" />
                                                </group>
                                                <group>
                                                    <field name="jenis_pembayaran" readonly="1" />
                                                    <field name="cash_remark" readonly="1" attrs="{'invisible': [('cash_remark','=',False)]}" />
                                                    <field name="supplier_id" readonly="1" attrs="{'invisible': [('supplier_id','=',False)]}" options="{'no_create':True, 'no_open':True}" />
                                                    <field name="amount_paid" readonly="1" />
                                                </group>
                                            </group>
                                            <notebook>
                                                <page string="Pembayaran">
                                                    <field name="payment_ids" nolabel="1" readonly="1">
                                                        <tree>
                                                            <field name="name" />
                                                            <field name="supplier_id" options="{'no_create': True, 'no_open': True}" />
                                                            <field name="jenis_pembayaran" />
                                                            <field name="amount_paid" />
                                                        </tree>
                                                    </field>
                                                </page>
                                                <page string="Audit Trail">
                                                    <group>
                                                        <group>
                                                            <field name="create_uid" readonly="1" />
                                                            <field name="create_date" readonly="1" />
                                                        </group>
                                                        <group>
                                                            <field name="write_uid" readonly="1" />
                                                            <field name="write_date" readonly="1" />
                                                        </group>
                                                    </group>
                                                </page>
                                            </notebook>
                                        </sheet>
                                    </form>
                                </field>
                                <group>
                                    <group class="oe_subtotal_footer oe_right">
                                        <field name="amount_total" readonly="1" />
                                        <field name="amount_reserved" readonly="1" />
                                        <field name="amount_paid" readonly="1" />
                                        <field name="amount_sisa" readonly="1" />
                                        <field name="amount_over" readonly="1" />
                                    </group>   
                                </group>
                            </page>
                            <page string="Sponsor">
                                <field name="sponsor_ids" nolabel="1" attrs="{'readonly':[('state','!=','draft')]}">
                                    <tree editable="top">
                                        <field name="supplier_id" required="1" domain="[('supplier','!=',False)]" options="{'no_create': True, 'no_open': True}" />
                                        <field name="amount" required="1" />
                                    </tree>
                                </field>
                                <group>
                                    <group class="oe_subtotal_footer oe_right">
                                        <field name="amount_total_sponsor" readonly="1" class="oe_subtotal_footer_separator" />
                                    </group>   
                                </group>
                            </page>
                            <page string="Schedule">
                                <field name="schedule_ids" nolabel="1" attrs="{'readonly':[('state','!=','draft')]}">
                                    <tree editable="top">
                                        <field name="location" required="1" />
                                        <field name="date_start" required="1" />
                                        <field name="date_end" required="1" />
                                        <field name="day_count" readonly="1" />
                                    </tree>
                                </field>
                            </page>
                            <page string="Dokumen">
                                <field name="attachment_ids" nolabel="1" attrs="{'readonly':[('state','!=','draft')]}">
                                    <tree editable="top">
                                        <field name="remark" required="1" />
                                        <field name="filename_upload" invisible="1" />
                                        <field name="files_upload" filename="filename_upload" />
                                        <field name="filename" readonly="1" />
                                        <field name="files" widget="binary" invisible="1" />
                                        <button name="export_file" string="Download" type="object" icon="gtk-ok" class="oe_highlight" />  
                                        <!-- readonly="1" -->
                                    </tree>
                                </field>
                            </page>
                            <page string="Budget Approval">
                                <field name="approval_ids">
                                    <tree string="Approval" editable="bottom" create="false" edit="false" delete="false" >
                                        <field name="group_id" />
                                        <field name="branch_id" />
                                        <field name="division" />
                                        <field name="sts" />
                                        <field name="reason" />
                                        <field name="pelaksana_id" />
                                        <field name="tanggal" />
                                    </tree>
                                    <form>
                                        <sheet>
                                            <group colspan="4" col="4">
                                                <field name="branch_id" readonly="1" options="{'no_create':True, 'no_open':True}" />
                                                <field name="tanggal" readonly="1" />
                                                <field name="group_id" readonly="1" options="{'no_create':True, 'no_open':True}" />
                                                <field name="division" readonly="1" />
                                                <field name="pelaksana_id" readonly="1" options="{'no_create':True, 'no_open':True}" />
                                                <field name="sts" readonly="1" />
                                                <field name="reason" readonly="1" />
                                            </group>
                                        </sheet>
                                    </form>
                                </field>
                            </page>
                            <page string="Pembayaran">
                                <field name="payment_ids" nolabel="1" readonly="1">
                                    <tree>
                                        <field name="payment_num" />
                                        <field name="payment_date" />
                                        <field name="payment_amount" sum="Total" />
                                    </tree>
                                </field>
                                <!-- <group>
                                    <group class="oe_subtotal_footer oe_right">
                                        
                                    </group>   
                                </group> -->
                            </page>
                            <page string="Audit Trail">
                                <group>
                                    <group>
                                        <field name="create_uid" readonly="1" />
                                        <field name="create_date" readonly="1" />
                                        <field name="close_uid" />
                                        <field name="close_date" />
                                    </group>
                                    <group>
                                        <field name="write_uid" readonly="1" />
                                        <field name="write_date" readonly="1" />
                                    </group>
                                </group>
                            </page>
                        </notebook>
            		</sheet>
            	</form>
            </field>
        </record>
        <record id="view_teds_proposal_filter" model="ir.ui.view">
            <field name="name">teds.proposal.filter</field>
            <field name="model">teds.proposal</field>
            <field name="arch" type="xml">
                <search string="Search Proposal">
                    <field name="name" string="Nomor Proposal"/>
                    <field name="branch_id" string="Dealer"/>
                    <field name="department_id" string="Departemen"/>
                    <field name="pic_id" string="PIC"/>
					<filter string="Draft" name="draft" domain="[('state','=','draft')]"/>
                    <filter string="Waiting for Approval" name="rfa" domain="[('state','=','rfa')]"/>
                    <filter string="Approved" name="approved" domain="[('state','=','approved')]"/>
					<group string="Group By" name="groupby">
                        <filter name="state_groupby" string="Status" context="{'group_by': 'state'}"/>
                        <filter name="branch_groupby" string="Dealer" context="{'group_by': 'branch_id'}"/>
                    </group>
                </search>
            </field>
        </record> 
        <record id="action_teds_proposal" model="ir.actions.server">
            <field name="name">Proposal</field>
            <field name="model_id" ref="teds_proposal.model_teds_proposal" />
            <field name="state">code</field>
			<field name="code">
                action = env['teds.proposal'].action_proposal_tree()
            </field>
        </record>    
    <!-- Print Proposal -->
        <report 
            string="Print Proposal" 
            id="report_proposal_pdf" 
            model="teds.proposal" 
            report_type="qweb-pdf"
            name="teds_proposal.print_proposal_pdf" 
            file="teds_proposal.print_proposal_pdf" 
            menu="False"
        />
    <!-- Paperformat Proposal -->
        <record id="paperformat_proposal" model="report.paperformat">
            <field name="name">Proposal</field>
            <field name="default" eval="True"/>
            <field name="format">A4</field>
            <field name="orientation">Portrait</field>
            <field name="margin_top">3</field>
            <field name="margin_bottom">3</field>
            <field name="margin_left">3</field>
            <field name="margin_right">3</field>
            <field name="header_line" eval="False"/>
            <field name="header_spacing">0</field>
            <field name="dpi">80</field>
        </record>
        <record id="report_proposal_pdf" model="ir.actions.report.xml">
            <field name="paperformat_id" ref="teds_proposal.paperformat_proposal"/>
        </record>
    <!-- Menu Proposal -->
        <menuitem 
            id="teds_proposal_menuitem" 
            parent="wtc_dealer_menu.backoffice_nontrade_menu" 
            action="action_teds_proposal" 
            sequence="1"
        />
    </data>
</openerp>